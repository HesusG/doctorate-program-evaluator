<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctorados - Espa√±a</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Doctorados</h1>
            <p>Explora programas de doctorado en universidades espa√±olas con un enfoque en ciencias qu√≠micas, biom√©dicas y relacionadas</p>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="mapa">üó∫Ô∏è Mapa Interactivo</div>
            <div class="tab" data-tab="tabla">üìä Vista Tabla</div>
            <div class="tab" data-tab="analisis">üìà An√°lisis</div>
            <div class="tab" data-tab="calificar">‚≠ê Calificar</div>
            <div class="tab" data-tab="ranking">üèÜ Ranking</div>
            <div class="tab" data-tab="admin">‚öôÔ∏è Admin</div>
        </div>

        <div class="filters">
            <h3>üîç Filtros</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label>Buscar Universidad</label>
                    <input type="text" id="search" placeholder="Buscar por nombre...">
                </div>
                <div class="filter-group">
                    <label>Ciudad</label>
                    <select id="ciudadFilter">
                        <option value="">Todas las ciudades</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>√çndice de Atracci√≥n</label>
                    <select id="atraccionFilter">
                        <option value="">Todos</option>
                        <option value="alto">Alto</option>
                        <option value="medio">Medio</option>
                        <option value="bajo">Bajo</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Costo de Vida</label>
                    <select id="costoFilter">
                        <option value="">Todos</option>
                        <option value="alto">Alto</option>
                        <option value="medio">Medio</option>
                        <option value="bajo">Bajo</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Status</label>
                    <select id="statusFilter">
                        <option value="">Todos</option>
                        <option value="activo">Activo</option>
                        <option value="inactivo">Inactivo</option>
                    </select>
                </div>
            </div>
            <div class="advanced-search">
                <button id="toggleAdvancedSearch" class="toggle-advanced-btn">B√∫squeda Avanzada ‚Üì</button>
                <div id="advancedSearchPanel" class="advanced-search-panel hidden">
                    <div class="advanced-search-row">
                        <div class="filter-group">
                            <label>B√∫squeda General</label>
                            <input type="text" id="searchTextAdvanced" placeholder="Buscar en todos los campos...">
                        </div>
                        <div class="filter-group">
                            <label>Universidad</label>
                            <input type="text" id="universidadAdvanced" placeholder="Nombre de universidad...">
                        </div>
                        <div class="filter-group">
                            <label>Ciudad</label>
                            <input type="text" id="ciudadAdvanced" placeholder="Nombre de ciudad...">
                        </div>
                        <div class="filter-group">
                            <label>Programa</label>
                            <input type="text" id="programaAdvanced" placeholder="Nombre de programa...">
                        </div>
                    </div>
                    <div class="advanced-search-row">
                        <div class="filter-group">
                            <label>L√≠neas de Investigaci√≥n</label>
                            <input type="text" id="lineaAdvanced" placeholder="Palabras clave...">
                        </div>
                        <div class="filter-group">
                            <label>Calificaci√≥n M√≠nima</label>
                            <select id="calificacionAdvanced">
                                <option value="">Cualquiera</option>
                                <option value="1">1+</option>
                                <option value="3">3+</option>
                                <option value="5">5+</option>
                                <option value="7">7+</option>
                                <option value="9">9+</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Innovaci√≥n M√≠nima</label>
                            <select id="innovacionAdvanced">
                                <option value="">Cualquiera</option>
                                <option value="1">1+</option>
                                <option value="3">3+</option>
                                <option value="5">5+</option>
                                <option value="7">7+</option>
                                <option value="9">9+</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Status</label>
                            <select id="statusAdvanced">
                                <option value="">Cualquiera</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="considerando">Considerando</option>
                                <option value="interesado">Interesado</option>
                                <option value="aplicando">Aplicando</option>
                                <option value="descartado">Descartado</option>
                            </select>
                        </div>
                    </div>
                    <div class="advanced-search-buttons">
                        <button id="advancedSearchButton" class="search-btn">Buscar</button>
                        <button id="resetAdvancedSearch" class="reset-btn">Restablecer</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Vista Mapa -->
            <div id="mapa-view" class="view">
                <div id="map"></div>
            </div>

            <!-- Vista Tabla -->
            <div id="tabla-view" class="view hidden">
                <div class="table-header">
                    <h3>Universidades y Programas</h3>
                    <button class="add-btn" onclick="agregarUniversidad()">+ Agregar Universidad</button>
                </div>
                <div class="table-container">
                    <table id="universidadesTable">
                        <thead>
                            <tr>
                                <th>Universidad</th>
                                <th>Ciudad</th>
                                <th>Programas</th>
                                <th>Programas por Estado</th>
                                <th>√çndice Atracci√≥n</th>
                                <th>Costo de Vida</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Vista An√°lisis -->
            <div id="analisis-view" class="view hidden">
                <div class="analysis-header">
                    <h3>üìà An√°lisis de Programas de Doctorado</h3>
                </div>
                
                <div id="analysisContent" class="analysis-content">
                    <div class="stats-grid">
                        <div class="stats-card">
                            <h4>Universidades</h4>
                            <div class="stats-number" id="universidadesCount">0</div>
                        </div>
                        <div class="stats-card">
                            <h4>Programas</h4>
                            <div class="stats-number" id="programasCount">0</div>
                        </div>
                        <div class="stats-card">
                            <h4>Ciudades</h4>
                            <div class="stats-number" id="ciudadesCount">0</div>
                        </div>
                    </div>
                    
                    <div class="charts-container">
                        <div class="chart-wrapper">
                            <h4>M√©tricas Acad√©micas</h4>
                            <div class="university-selector-container">
                                <select id="universitySelector" onchange="updateCharts()">
                                    <option value="">Seleccionar Universidad</option>
                                </select>
                            </div>
                            <div class="radar-chart-container">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-wrapper">
                            <h4>Calidad de Vida</h4>
                            <div class="radar-chart-container">
                                <canvas id="cityRadarChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="summary-container">
                        <h4>Resumen</h4>
                        <div id="universitySummary" class="summary-content">
                            <p>Selecciona una universidad para ver su an√°lisis detallado.</p>
                        </div>
                    </div>
                    
                    <div class="alert info-alert hidden" id="noDataAlert">
                        <p>No hay datos enriquecidos disponibles. Usa la secci√≥n de Admin para enriquecer los datos con IA.</p>
                    </div>
                </div>
            </div>
            
            <!-- Vista Calificar -->
            <div id="calificar-view" class="view hidden">
                <div class="calificar-header">
                    <h3>‚≠ê Calificar Programas</h3>
                </div>
                
                <div class="calificar-content">
                    <div class="calificar-filters">
                        <div class="filter-group">
                            <label>Filtrar por Universidad</label>
                            <select id="calificarUniversityFilter" onchange="filterProgramsToRate()">
                                <option value="">Todas las universidades</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Filtrar por Ciudad</label>
                            <select id="calificarCityFilter" onchange="filterProgramsToRate()">
                                <option value="">Todas las ciudades</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Estado de Calificaci√≥n</label>
                            <select id="calificarStatusFilter" onchange="filterProgramsToRate()">
                                <option value="">Todos</option>
                                <option value="pendiente">Pendientes</option>
                                <option value="calificado">Calificados</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Buscar</label>
                            <input type="text" id="calificarSearchFilter" placeholder="Buscar programas..." oninput="filterProgramsToRate()">
                        </div>
                    </div>
                    
                    <div class="favorite-section">
                        <h4>Programas Favoritos</h4>
                        <div id="favoritesContainer" class="favorites-container">
                            <p class="no-favorites-message">No hay programas favoritos guardados.</p>
                        </div>
                    </div>
                    
                    <div id="programsContainer" class="programs-container">
                        <!-- Programs will be loaded here dynamically -->
                        <div class="loading-message">Cargando programas...</div>
                    </div>
                </div>
            </div>
            
            <!-- Vista Ranking -->
            <div id="ranking-view" class="view hidden">
                <div class="ranking-header">
                    <h3>üèÜ Ranking de Programas</h3>
                </div>
                
                <div class="ranking-content">
                    <div class="ranking-filters">
                        <div class="filter-group">
                            <label>Filtrar por Universidad</label>
                            <select id="rankingUniversityFilter" onchange="filterRankings()">
                                <option value="">Todas las universidades</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Filtrar por Ciudad</label>
                            <select id="rankingCityFilter" onchange="filterRankings()">
                                <option value="">Todas las ciudades</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Ver Top</label>
                            <select id="rankingLimitFilter" onchange="filterRankings()">
                                <option value="10">10 mejores</option>
                                <option value="20">20 mejores</option>
                                <option value="50">50 mejores</option>
                                <option value="0">Todos</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <div class="stats-grid">
                            <div class="stats-card">
                                <h4>Programas Calificados</h4>
                                <div class="stats-number" id="programasCalificadosCount">0</div>
                            </div>
                            <div class="stats-card">
                                <h4>Calificaci√≥n Promedio</h4>
                                <div class="stats-number" id="calificacionPromedio">0.0</div>
                            </div>
                            <div class="stats-card">
                                <h4>Top Universidad</h4>
                                <div class="stats-text" id="topUniversidad">-</div>
                            </div>
                            <div class="stats-card">
                                <h4>Top Ciudad</h4>
                                <div class="stats-text" id="topCiudad">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ranking-table-container">
                        <h4>Programas Mejor Calificados</h4>
                        <table id="rankingTable" class="ranking-table">
                            <thead>
                                <tr>
                                    <th>Posici√≥n</th>
                                    <th>Programa</th>
                                    <th>Universidad</th>
                                    <th>Ciudad</th>
                                    <th>Calificaci√≥n</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="rankingTableBody">
                                <!-- Ranking rows will be added here -->
                                <tr>
                                    <td colspan="7" class="no-data">No hay programas calificados</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="chart-section">
                        <h4>Distribuci√≥n de Calificaciones</h4>
                        <div class="chart-container">
                            <canvas id="gradesDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Vista Admin -->
            <div id="admin-view" class="view hidden">
                <div class="admin-header">
                    <h3>‚öôÔ∏è Panel de Administraci√≥n</h3>
                </div>
                
                <div class="admin-content">
                    <div class="admin-section">
                        <h4>üîÑ Enriquecimiento de Datos</h4>
                        <p>Esta funci√≥n utiliza inteligencia artificial para enriquecer los datos existentes con:</p>
                        <ul>
                            <li>Coordenadas geogr√°ficas para cada ciudad</li>
                            <li>Res√∫menes de programas y l√≠neas de investigaci√≥n</li>
                            <li>M√©tricas acad√©micas para cada universidad</li>
                            <li>Datos de calidad de vida para cada ciudad</li>
                        </ul>
                        <div class="action-container">
                            <button id="enrichButton" class="enrich-btn" onclick="confirmEnrichData()">
                                üîÑ Enriquecer Datos con IA
                            </button>
                            <div id="loadingIndicator" class="loading-indicator hidden">
                                <div class="loading-spinner"></div>
                                <span>Procesando datos...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-section">
                        <h4>üìç Correcci√≥n de Datos Geogr√°ficos</h4>
                        <p>Esta funci√≥n corrige los siguientes problemas en los datos geogr√°ficos:</p>
                        <ul>
                            <li>Coordenadas incorrectas o faltantes de ciudades</li>
                            <li>Distancias err√≥neas a Madrid</li>
                            <li>M√©tricas incoherentes relacionadas con la ubicaci√≥n</li>
                        </ul>
                        <p>Utiliza una base de datos verificada de coordenadas de ciudades espa√±olas.</p>
                        <div class="action-container">
                            <button id="fixGeoButton" class="fix-geo-btn" onclick="confirmFixGeographicData()">
                                üó∫Ô∏è Corregir Datos Geogr√°ficos
                            </button>
                            <div id="geoFixProgressContainer" class="progress-container hidden">
                                <div class="progress-bar">
                                    <div id="geoFixProgressBar" class="progress-bar-fill" style="width: 0%"></div>
                                </div>
                                <div id="geoFixProgressText" class="progress-text">0%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Panel -->
    <div class="info-panel" id="infoPanel">
        <button class="close-btn" onclick="closeInfoPanel()">√ó</button>
        <div id="infoPanelContent"></div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="script.js"></script>
</body>
</html>