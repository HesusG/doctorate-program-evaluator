<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctorados - Espa√±a</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/rowgroup/1.4.1/css/rowGroup.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.7.0/css/select.dataTables.min.css">
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jQuery y DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/rowgroup/1.4.1/js/dataTables.rowGroup.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.7.0/js/dataTables.select.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Doctorados</h1>
            <p>Explora programas de doctorado en universidades espa√±olas con un enfoque en ciencias qu√≠micas, biom√©dicas y relacionadas</p>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="mapa">üó∫Ô∏è Mapa Interactivo</div>
            <div class="tab" data-tab="tabla">üìä Vista Tabla</div>
            <div class="tab" data-tab="analisis">üìà An√°lisis</div>
            <div class="tab" data-tab="calificar">‚≠ê Calificar</div>
            <div class="tab" data-tab="ranking">üèÜ Ranking</div>
            <div class="tab" data-tab="admin">‚öôÔ∏è Admin</div>
        </div>

        <div class="filters">
            <h3>üîç Filtros</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label>Buscar Universidad</label>
                    <input type="text" id="search" placeholder="Buscar por nombre...">
                </div>
                <div class="filter-group">
                    <label>Ciudad</label>
                    <select id="ciudadFilter">
                        <option value="">Todas las ciudades</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Calificaci√≥n M√≠nima</label>
                    <select id="calificacionFilter">
                        <option value="">Todos</option>
                        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê+</option>
                        <option value="3">‚≠ê‚≠ê‚≠ê+</option>
                        <option value="2">‚≠ê‚≠ê+</option>
                        <option value="1">‚≠ê+</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Costo de Vida</label>
                    <select id="costoFilter">
                        <option value="">Todos</option>
                        <option value="50">Alto (50+)</option>
                        <option value="30">Medio (30-50)</option>
                        <option value="0">Bajo (0-30)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Status</label>
                    <select id="statusFilter">
                        <option value="">Todos</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="considerando">Considerando</option>
                        <option value="interesado">Interesado</option>
                        <option value="aplicando">Aplicando</option>
                        <option value="descartado">Descartado</option>
                    </select>
                </div>
            </div>
            <div class="advanced-search">
                <button id="toggleAdvancedSearch" class="toggle-advanced-btn">B√∫squeda Avanzada ‚Üì</button>
                <div id="advancedSearchPanel" class="advanced-search-panel hidden">
                    <div class="advanced-search-row">
                        <div class="filter-group">
                            <label>B√∫squeda General</label>
                            <input type="text" id="searchTextAdvanced" placeholder="Buscar en todos los campos...">
                        </div>
                        <div class="filter-group">
                            <label>Universidad</label>
                            <input type="text" id="universidadAdvanced" placeholder="Nombre de universidad...">
                        </div>
                        <div class="filter-group">
                            <label>Ciudad</label>
                            <input type="text" id="ciudadAdvanced" placeholder="Nombre de ciudad...">
                        </div>
                        <div class="filter-group">
                            <label>Programa</label>
                            <input type="text" id="programaAdvanced" placeholder="Nombre de programa...">
                        </div>
                    </div>
                    <div class="advanced-search-row">
                        <div class="filter-group">
                            <label>L√≠neas de Investigaci√≥n</label>
                            <input type="text" id="lineaAdvanced" placeholder="Palabras clave...">
                        </div>
                        <div class="filter-group">
                            <label>Calificaci√≥n M√≠nima</label>
                            <select id="calificacionAdvanced">
                                <option value="">Cualquiera</option>
                                <option value="1">1+</option>
                                <option value="3">3+</option>
                                <option value="5">5+</option>
                                <option value="7">7+</option>
                                <option value="9">9+</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Innovaci√≥n M√≠nima</label>
                            <select id="innovacionAdvanced">
                                <option value="">Cualquiera</option>
                                <option value="1">1+</option>
                                <option value="3">3+</option>
                                <option value="5">5+</option>
                                <option value="7">7+</option>
                                <option value="9">9+</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Status</label>
                            <select id="statusAdvanced">
                                <option value="">Cualquiera</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="considerando">Considerando</option>
                                <option value="interesado">Interesado</option>
                                <option value="aplicando">Aplicando</option>
                                <option value="descartado">Descartado</option>
                            </select>
                        </div>
                    </div>
                    <div class="advanced-search-buttons">
                        <button id="advancedSearchButton" class="search-btn">Buscar</button>
                        <button id="resetAdvancedSearch" class="reset-btn">Restablecer</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Vista Mapa -->
            <div id="mapa-view" class="view">
                <div id="map"></div>
            </div>

            <!-- Vista Tabla -->
            <div id="tabla-view" class="view hidden">
                <div class="table-header">
                    <h3>Universidades y Programas</h3>
                    <div class="table-actions">
                        <button class="add-btn" onclick="agregarUniversidad()">+ Agregar Universidad</button>
                        <button class="add-program-btn" onclick="mostrarAgregarPrograma()">+ Agregar Programa</button>
                        <button class="save-btn" id="saveTableChanges">üíæ Guardar Cambios</button>
                    </div>
                </div>
                
                <!-- Panel principal de universidades -->
                <div class="universities-container">
                    <!-- Las universidades se cargar√°n din√°micamente -->
                </div>
                
                <!-- Paginaci√≥n para universidades -->
                <div class="universities-pagination">
                    <button class="pagination-btn pagination-prev" disabled>&lt; Anterior</button>
                    <span class="pagination-info">P√°gina <span class="current-page">1</span> de <span class="total-pages">1</span></span>
                    <button class="pagination-btn pagination-next" disabled>Siguiente &gt;</button>
                </div>
                
                <!-- Plantilla para los paneles de universidad -->
                <template id="university-panel-template">
                    <div class="university-panel">
                        <div class="university-header">
                            <div class="university-title-section">
                                <button class="toggle-university-btn">‚ñº</button>
                                <h4 class="university-name">Nombre de Universidad</h4>
                            </div>
                            <div class="university-meta">
                                <span class="university-city">Ciudad</span>
                                <span class="program-count">0 programas</span>
                            </div>
                            <div class="university-actions">
                                <button class="add-program-uni-btn">+ Programa</button>
                                <button class="edit-university-btn">‚úèÔ∏è Editar</button>
                            </div>
                        </div>
                        <div class="programs-container hidden">
                            <!-- Los programas se cargar√°n din√°micamente -->
                        </div>
                        <div class="university-pagination">
                            <button class="pagination-prev" disabled>‚Üê Anterior</button>
                            <span class="pagination-info">P√°gina <span class="current-page">1</span> de <span class="total-pages">1</span></span>
                            <button class="pagination-next" disabled>Siguiente ‚Üí</button>
                        </div>
                    </div>
                </template>
                
                <!-- Plantilla para las tarjetas de programa -->
                <template id="program-card-template">
                    <div class="program-card">
                        <div class="program-header">
                            <div class="program-title-container">
                                <h5 class="program-name">Nombre del Programa</h5>
                                <a href="#" target="_blank" class="program-link">üîó Link</a>
                            </div>
                            <div class="program-status-container">
                                <select class="status-select">
                                    <option value="pendiente">Pendiente</option>
                                    <option value="considerando">Considerando</option>
                                    <option value="interesado">Interesado</option>
                                    <option value="aplicando">Aplicando</option>
                                    <option value="descartado">Descartado</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="program-content">
                            <div class="program-rating-section">
                                <div class="section-label">Calificaci√≥n:</div>
                                <div class="rating-stars"></div>
                            </div>
                            
                            <div class="program-summary-section">
                                <div class="section-label">Resumen:</div>
                                <div class="editable-field resumen-field" data-field="resumen">
                                    <div class="field-content">Sin resumen disponible</div>
                                </div>
                            </div>
                            
                            <div class="program-lines-section">
                                <div class="section-header">
                                    <div class="section-label">L√≠neas de Investigaci√≥n:</div>
                                    <button class="toggle-lines-btn">‚ñ∂</button>
                                </div>
                                <div class="lines-content hidden">
                                    <div class="editable-field lines-field" data-field="linea_investigacion">
                                        <div class="field-content">Sin l√≠neas de investigaci√≥n disponibles</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="program-metrics-section">
                                <div class="section-header">
                                    <div class="section-label">M√©tricas Acad√©micas:</div>
                                    <button class="toggle-metrics-btn">‚ñ∂</button>
                                </div>
                                <div class="metrics-content hidden">
                                    <div class="metric-row">
                                        <span class="metric-label">Innovaci√≥n:</span>
                                        <div class="editable-field metric-field" data-field="innovacion">
                                            <div class="field-content">N/A</div>
                                        </div>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">Interdisciplinariedad:</span>
                                        <div class="editable-field metric-field" data-field="interdisciplinariedad">
                                            <div class="field-content">N/A</div>
                                        </div>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">Impacto:</span>
                                        <div class="editable-field metric-field" data-field="impacto">
                                            <div class="field-content">N/A</div>
                                        </div>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">Internacional:</span>
                                        <div class="editable-field metric-field" data-field="internacional">
                                            <div class="field-content">N/A</div>
                                        </div>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">Aplicabilidad:</span>
                                        <div class="editable-field metric-field" data-field="aplicabilidad">
                                            <div class="field-content">N/A</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="program-city-section">
                                <div class="section-header">
                                    <div class="section-label">Datos de Ciudad:</div>
                                    <button class="toggle-city-btn">‚ñ∂</button>
                                </div>
                                <div class="city-content hidden">
                                    <div class="metric-row">
                                        <span class="metric-label">Costo de Vida:</span>
                                        <div class="editable-field costo-field" data-field="costo_vida">
                                            <div class="field-content">N/A</div>
                                        </div>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">Calidad del Aire:</span>
                                        <div class="editable-field calidad-field" data-field="calidad_aire">
                                            <div class="field-content">N/A</div>
                                        </div>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">Calidad del Transporte:</span>
                                        <div class="editable-field calidad-field" data-field="calidad_transporte">
                                            <div class="field-content">N/A</div>
                                        </div>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">Calidad del Servicio M√©dico:</span>
                                        <div class="editable-field calidad-field" data-field="calidad_servicio_medico">
                                            <div class="field-content">N/A</div>
                                        </div>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-label">Distancia a Madrid:</span>
                                        <div class="editable-field distancia-field" data-field="distancia_a_madrid_km">
                                            <div class="field-content">N/A</div>
                                        </div>
                                    </div>
                                    <div class="metric-row city-description">
                                        <span class="metric-label">Descripci√≥n:</span>
                                        <div class="city-description-content">Sin descripci√≥n disponible</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="program-actions">
                                <button class="edit-program-btn">‚úèÔ∏è Editar</button>
                                <button class="save-program-btn" disabled>üíæ Guardar</button>
                                <button class="delete-program-btn">üóëÔ∏è Eliminar</button>
                                <button class="duplicate-program-btn">üîÑ Duplicar</button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
            
            <!-- Modal de Confirmaci√≥n para Guardar -->
            <div id="saveConfirmModal" class="modal">
                <div class="modal-content">
                    <h4>Confirmar Cambios</h4>
                    <p>¬øEst√°s seguro de que quieres guardar todos los cambios realizados?</p>
                    <div class="modal-actions">
                        <button id="confirmSaveBtn" class="confirm-btn">S√≠, guardar cambios</button>
                        <button id="cancelSaveBtn" class="cancel-btn">Cancelar</button>
                    </div>
                </div>
            </div>
            
            <!-- Modal para Agregar Programa -->
            <div id="addProgramModal" class="modal">
                <div class="modal-content">
                    <h4>Agregar Nuevo Programa</h4>
                    <div class="form-group">
                        <label>Universidad:</label>
                        <select id="universidadSelect">
                            <!-- Las universidades se cargar√°n din√°micamente -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nombre del Programa:</label>
                        <input type="text" id="programaNombre" placeholder="Nombre del programa de doctorado">
                    </div>
                    <div class="form-group">
                        <label>URL:</label>
                        <input type="text" id="programaURL" placeholder="https://...">
                    </div>
                    <div class="form-group">
                        <label>Resumen:</label>
                        <textarea id="programaResumen" placeholder="Descripci√≥n del programa..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Status:</label>
                        <select id="programaStatus">
                            <option value="pendiente">Pendiente</option>
                            <option value="considerando">Considerando</option>
                            <option value="interesado">Interesado</option>
                            <option value="aplicando">Aplicando</option>
                            <option value="descartado">Descartado</option>
                        </select>
                    </div>
                    <div class="modal-actions">
                        <button id="saveProgramBtn" class="confirm-btn">Guardar Programa</button>
                        <button id="cancelProgramBtn" class="cancel-btn">Cancelar</button>
                    </div>
                </div>
            </div>
            
            <!-- Modal para Enriquecimiento con IA (individual) -->
            <div id="enrichProgramModal" class="modal">
                <div class="modal-content">
                    <h4>Enriquecer Programa con IA</h4>
                    <p>Selecciona el modelo de IA y las opciones de enriquecimiento:</p>
                    
                    <div class="form-group">
                        <label>Modelo de IA:</label>
                        <select id="aiModelSelect">
                            <option value="gpt-3.5">GPT-3.5 (R√°pido)</option>
                            <option value="omni-light">Omni Light (Econ√≥mico)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Opciones:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" id="enrichResumen" checked> Generar resumen</label>
                            <label><input type="checkbox" id="enrichMetrics" checked> Calcular m√©tricas</label>
                            <label><input type="checkbox" id="enrichCiudad" checked> Datos de ciudad</label>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button id="startEnrichBtn" class="confirm-btn">Iniciar enriquecimiento</button>
                        <button id="cancelEnrichBtn" class="cancel-btn">Cancelar</button>
                    </div>
                </div>
            </div>

            <!-- Vista An√°lisis -->
            <div id="analisis-view" class="view hidden">
                <div class="analysis-header">
                    <h3>üìà An√°lisis de Programas de Doctorado</h3>
                </div>
                
                <div id="analysisContent" class="analysis-content">
                    <div class="stats-grid">
                        <div class="stats-card">
                            <h4>Universidades</h4>
                            <div class="stats-number" id="universidadesCount">0</div>
                        </div>
                        <div class="stats-card">
                            <h4>Programas</h4>
                            <div class="stats-number" id="programasCount">0</div>
                        </div>
                        <div class="stats-card">
                            <h4>Ciudades</h4>
                            <div class="stats-number" id="ciudadesCount">0</div>
                        </div>
                    </div>
                    
                    <div class="charts-container">
                        <div class="chart-wrapper">
                            <h4>M√©tricas Acad√©micas</h4>
                            <div class="university-selector-container">
                                <select id="universitySelector" onchange="updateCharts()">
                                    <option value="">Seleccionar Universidad</option>
                                </select>
                            </div>
                            <div class="radar-chart-container">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-wrapper">
                            <h4>Calidad de Vida</h4>
                            <div class="radar-chart-container">
                                <canvas id="cityRadarChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="summary-container">
                        <h4>Resumen</h4>
                        <div id="universitySummary" class="summary-content">
                            <p>Selecciona una universidad para ver su an√°lisis detallado.</p>
                        </div>
                    </div>
                    
                    <div class="alert info-alert hidden" id="noDataAlert">
                        <p>No hay datos enriquecidos disponibles. Usa la secci√≥n de Admin para enriquecer los datos con IA.</p>
                    </div>
                </div>
            </div>
            
            <!-- Vista Calificar -->
            <div id="calificar-view" class="view hidden">
                <div class="calificar-header">
                    <h3>‚≠ê Calificar Programas</h3>
                </div>
                
                <div class="calificar-content">
                    <!-- Statistics Panel -->
                    <div class="stats-panel">
                        <div class="stats-card">
                            <div class="stats-label">Universidades</div>
                            <div class="stats-value" id="university-count">0</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-label">Documentos</div>
                            <div class="stats-value" id="document-count">0</div>
                        </div>
                        <div class="status-distribution" id="status-distribution">
                            <!-- Status counts will be loaded here dynamically -->
                        </div>
                        <div class="export-buttons">
                            <button id="export-json" class="export-btn json-btn">üì• Exportar JSON</button>
                            <button id="export-csv" class="export-btn csv-btn">üìä Exportar CSV</button>
                        </div>
                    </div>
                    
                    <!-- Simple Filter Panel -->
                    <div class="calificar-filters">
                        <div class="filter-section">
                            <div class="filter-group">
                                <label>Filtrar por Calificaci√≥n</label>
                                <div class="rating-filter-buttons">
                                    <button id="filter-not-rated" class="filter-btn active" onclick="filterByRating('not-rated')">No Calificados</button>
                                    <button id="filter-rated" class="filter-btn" onclick="filterByRating('rated')">Calificados</button>
                                    <button id="filter-all-ratings" class="filter-btn" onclick="filterByRating('all')">Todos</button>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label>Filtrar por Estado</label>
                                <select id="simpleStatusFilter" onchange="filterProgramsByStatus()">
                                    <option value="">Todos los estados</option>
                                    <option value="pendiente">Pendiente</option>
                                    <option value="considerando">Considerando</option>
                                    <option value="interesado">Interesado</option>
                                    <option value="aplicando">Aplicando</option>
                                    <option value="descartado">Descartado</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Programs Table -->
                    <div class="programs-table-container">
                        <table id="programs-table" class="programs-table">
                            <thead>
                                <tr>
                                    <th>Programa</th>
                                    <th>Estado</th>
                                    <th>Calificaci√≥n</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="programs-table-body">
                                <!-- Programs will be loaded here dynamically -->
                                <tr>
                                    <td colspan="4" class="loading-cell">Cargando programas...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Program Edit Modal -->
                <div id="program-edit-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4>Editar Programa</h4>
                            <span class="close-modal">&times;</span>
                        </div>
                        <div class="modal-body">
                            <form id="program-edit-form">
                                <input type="hidden" id="edit-program-id">
                                
                                <div class="form-group">
                                    <label>Nombre del Programa</label>
                                    <input type="text" id="edit-program-name" disabled>
                                </div>
                                
                                <div class="form-group">
                                    <label>Universidad</label>
                                    <input type="text" id="edit-program-university" disabled>
                                </div>
                                
                                <div class="form-group">
                                    <label>Ciudad</label>
                                    <input type="text" id="edit-program-city" disabled>
                                </div>
                                
                                <div class="form-group">
                                    <label>Estado</label>
                                    <select id="edit-program-status">
                                        <option value="pendiente">Pendiente</option>
                                        <option value="considerando">Considerando</option>
                                        <option value="interesado">Interesado</option>
                                        <option value="aplicando">Aplicando</option>
                                        <option value="descartado">Descartado</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Calificaci√≥n</label>
                                    <div class="rating-input">
                                        <div class="star-rating" id="edit-program-rating">
                                            <span class="star" data-value="1">‚òÖ</span>
                                            <span class="star" data-value="2">‚òÖ</span>
                                            <span class="star" data-value="3">‚òÖ</span>
                                            <span class="star" data-value="4">‚òÖ</span>
                                            <span class="star" data-value="5">‚òÖ</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>URL</label>
                                    <input type="text" id="edit-program-url">
                                </div>
                                
                                <div class="form-group">
                                    <label>L√≠neas de Investigaci√≥n</label>
                                    <textarea id="edit-program-lines" rows="5"></textarea>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" id="save-program-changes" class="save-btn">Guardar Cambios</button>
                                    <button type="button" id="duplicate-program" class="duplicate-btn">Duplicar Programa</button>
                                    <button type="button" id="cancel-program-edit" class="cancel-btn">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Rating Confirmation Modal -->
                <div id="rating-confirm-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4>Confirmar Calificaci√≥n</h4>
                            <span class="close-rating-modal">&times;</span>
                        </div>
                        <div class="modal-body">
                            <p>¬øEst√°s seguro de calificar este programa con <span id="rating-value-text">0</span> estrellas?</p>
                            <input type="hidden" id="rating-program-id">
                            <input type="hidden" id="rating-value">
                            
                            <div class="form-actions">
                                <button type="button" id="confirm-rating" class="save-btn">Confirmar</button>
                                <button type="button" id="cancel-rating" class="cancel-btn">Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Vista Ranking -->
            <div id="ranking-view" class="view hidden">
                <div class="ranking-header">
                    <h3>üèÜ Ranking de Programas</h3>
                </div>
                
                <div class="ranking-content">
                    <div class="ranking-filters">
                        <div class="filter-group">
                            <label>Filtrar por Universidad</label>
                            <select id="rankingUniversityFilter" onchange="filterRankings()">
                                <option value="">Todas las universidades</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Filtrar por Ciudad</label>
                            <select id="rankingCityFilter" onchange="filterRankings()">
                                <option value="">Todas las ciudades</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Ver Top</label>
                            <select id="rankingLimitFilter" onchange="filterRankings()">
                                <option value="10">10 mejores</option>
                                <option value="20">20 mejores</option>
                                <option value="50">50 mejores</option>
                                <option value="0">Todos</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <div class="stats-grid">
                            <div class="stats-card">
                                <h4>Programas Calificados</h4>
                                <div class="stats-number" id="programasCalificadosCount">0</div>
                            </div>
                            <div class="stats-card">
                                <h4>Calificaci√≥n Promedio</h4>
                                <div class="stats-number" id="calificacionPromedio">0.0</div>
                            </div>
                            <div class="stats-card">
                                <h4>Top Universidad</h4>
                                <div class="stats-text" id="topUniversidad">-</div>
                            </div>
                            <div class="stats-card">
                                <h4>Top Ciudad</h4>
                                <div class="stats-text" id="topCiudad">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ranking-table-container">
                        <h4>Programas Mejor Calificados</h4>
                        <table id="rankingTable" class="ranking-table">
                            <thead>
                                <tr>
                                    <th>Posici√≥n</th>
                                    <th>Programa</th>
                                    <th>Universidad</th>
                                    <th>Ciudad</th>
                                    <th>Calificaci√≥n</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="rankingTableBody">
                                <!-- Ranking rows will be added here -->
                                <tr>
                                    <td colspan="7" class="no-data">No hay programas calificados</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="chart-section">
                        <h4>Distribuci√≥n de Calificaciones</h4>
                        <div class="chart-container">
                            <canvas id="gradesDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Vista Admin -->
            <div id="admin-view" class="view hidden">
                <div class="admin-header">
                    <h3>‚öôÔ∏è Panel de Administraci√≥n</h3>
                </div>
                
                <div class="admin-content">
                    <div class="admin-section">
                        <h4>üîÑ Enriquecimiento de Datos</h4>
                        <p>Esta funci√≥n utiliza inteligencia artificial para enriquecer los datos existentes con:</p>
                        <ul>
                            <li>Coordenadas geogr√°ficas para cada ciudad</li>
                            <li>Res√∫menes de programas y l√≠neas de investigaci√≥n</li>
                            <li>M√©tricas acad√©micas para cada universidad</li>
                            <li>Datos de calidad de vida para cada ciudad</li>
                        </ul>
                        
                        <div class="enrich-controls">
                            <div class="enrich-options">
                                <label><input type="checkbox" id="adminEnrichResumen" checked> Res√∫menes</label>
                                <label><input type="checkbox" id="adminEnrichMetrics" checked> M√©tricas acad√©micas</label>
                                <label><input type="checkbox" id="adminEnrichCiudad" checked> Datos de ciudad</label>
                            </div>
                            
                            <div class="last-enrichment-info">
                                <span id="lastEnrichmentText">√öltimo enriquecimiento: No hay datos</span>
                            </div>
                            
                            <div class="action-container">
                                <button id="enrichButton" class="enrich-btn" onclick="confirmEnrichData()">
                                    üîÑ Enriquecer Datos con IA
                                </button>
                            </div>
                        </div>
                        
                        <div id="enrichProgressContainer" class="progress-container hidden">
                            <div class="current-university-info">
                                <strong>Procesando:</strong> <span id="currentUniversityName">-</span>
                            </div>
                            <div class="progress-bar">
                                <div id="enrichProgressBar" class="progress-bar-fill" style="width: 0%"></div>
                            </div>
                            <div class="progress-details">
                                <span id="currentUniversityNumber">0</span> de <span id="totalUniversities">0</span> universidades
                                (<span id="enrichProgressText">0%</span>)
                            </div>
                        </div>
                        
                        <div id="enrichLogContainer" class="enrich-log-container hidden">
                            <h5>Registro de Actividad</h5>
                            <div id="enrichLog" class="enrich-log"></div>
                        </div>
                    </div>
                    
                    <div class="admin-section">
                        <h4>üìç Correcci√≥n de Datos Geogr√°ficos</h4>
                        <p>Esta funci√≥n corrige los siguientes problemas en los datos geogr√°ficos:</p>
                        <ul>
                            <li>Coordenadas incorrectas o faltantes de ciudades</li>
                            <li>Distancias err√≥neas a Madrid</li>
                            <li>M√©tricas incoherentes relacionadas con la ubicaci√≥n</li>
                        </ul>
                        <p>Utiliza una base de datos verificada de coordenadas de ciudades espa√±olas.</p>
                        
                        <div class="action-container">
                            <button id="fixGeoButton" class="fix-geo-btn" onclick="confirmFixGeographicData()">
                                üó∫Ô∏è Corregir Datos Geogr√°ficos
                            </button>
                        </div>
                        
                        <div id="geoFixProgressContainer" class="progress-container hidden">
                            <div class="current-university-info">
                                <strong>Procesando:</strong> <span id="currentGeoCity">-</span>
                            </div>
                            <div class="progress-bar">
                                <div id="geoFixProgressBar" class="progress-bar-fill" style="width: 0%"></div>
                            </div>
                            <div class="progress-details">
                                <span id="currentGeoNumber">0</span> de <span id="totalGeoCities">0</span> ciudades
                                (<span id="geoFixProgressText">0%</span>)
                            </div>
                        </div>
                        
                        <div id="geoFixLogContainer" class="enrich-log-container hidden">
                            <h5>Registro de Actividad</h5>
                            <div id="geoFixLog" class="enrich-log"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Panel -->
    <div class="info-panel" id="infoPanel">
        <button class="close-btn" onclick="closeInfoPanel()">√ó</button>
        <div id="infoPanelContent"></div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="script.js"></script>
    <script src="table-view-improved.js"></script>
    <script src="calificar-view.js"></script>
</body>
</html>